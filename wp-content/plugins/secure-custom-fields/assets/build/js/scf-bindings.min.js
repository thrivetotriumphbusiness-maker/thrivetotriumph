(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,n=window.wp.coreData,r=window.wp.editor,s=window.wp.i18n;function o(e){return e?e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):""}let l={};const c=e=>l[e]||null;(0,t.registerBlockBindingsSource)({name:"acf/field",label:(0,s.__)("SCF Fields","secure-custom-fields"),getLabel({args:e,select:t}){const n=e?.key;if(!n)return(0,s.__)("SCF Fields","secure-custom-fields");const r=c(n);return r?.label?r.label:o(n)},getValues({context:e,bindings:t,select:s}){const{getCurrentPostType:l}=s(r.store);if("wp_template"===l()){const e={};return Object.entries(t).forEach(([t,{args:n}={}])=>{const r=n?.key;if(!r)return void(e[t]="");const s=c(r);e[t]=s?.label||o(r)}),e}const{getEditedEntityRecord:i}=s(n.store),a=function(e){if(!e?.acf)return{};const t={};return Object.entries(e.acf).forEach(([e,n])=>{if(e.endsWith("_source")){const r=e.replace("_source","");t[r]=n}}),t}(e?.postType&&e?.postId?i("postType",e.postType,e.postId):void 0),u={};return Object.entries(t).forEach(([e,{args:t}={}])=>{const n=function(e,t,n){const r=t?.key,s=n[r];if(!s)return"";const o=s.type,l=s.formatted_value;switch(o){case"image":return function(e,t){if(!e)return"";switch(t){case"url":return e.url||"";case"alt":return e.alt||"";case"title":return e.title||"";case"id":return e.id||e.ID||"";default:return""}}(l,e);case"checkbox":return Array.isArray(l)?l.join(", "):l?String(l):"";default:return l?String(l):""}}(e,t,a);u[e]=n}),u},canUserEditValue:()=>!1});const i=window.wp.element,a=window.wp.hooks,u=window.wp.compose,d=window.wp.blockEditor,p=window.wp.components,f={"core/paragraph":{content:["text","textarea","date_picker","number","range"]},"core/heading":{content:["text","textarea","date_picker","number","range"]},"core/image":{id:["image"],url:["image"],title:["image"],alt:["image"]},"core/button":{url:["url"],text:["text","checkbox","select","date_picker"],linkTarget:["text","checkbox","select"],rel:["text","checkbox","select"]}},g="acf/field";function m(e,t,n=null){if(!e||0===e.length)return[];const r=function(e,t=null){const n=f[e];return n?t?n[t]||null:[...new Set(Object.values(n).flat())]:null}(t,n);return r?e.filter(e=>r.includes(e.type)):e}const h=window.wp.data,w=window.wp.apiFetch;var b=e.n(w);const y=window.wp.url;function _(e){const[t,n]=(0,i.useState)({}),[r,s]=(0,i.useState)(!1),[o,c]=(0,i.useState)(null);return(0,i.useEffect)(()=>{if(!e)return n({}),s(!1),void c(null);let t=!1;s(!0),c(null);return(async()=>{try{const r=(0,y.addQueryArgs)(`/wp/v2/types/${e}`,{context:"edit"}),o=await b()({path:r});if(t)return;const c=function(e){const t={};return Array.isArray(e)?(e.forEach(e=>{Array.isArray(e.fields)&&e.fields.forEach(e=>{t[e.name]={label:e.label,type:e.type}})}),t):t}(o.scf_field_groups);(e=>{l={...l,...e}})(c),n(c),s(!1)}catch(e){t||(c(e),s(!1))}})(),()=>{t=!0}},[e]),{fields:t,isLoading:r,error:o}}const x=window.ReactJSXRuntime,k=(0,u.createHigherOrderComponent)(e=>t=>{const o=function(e){const t=f[e];return t?Object.keys(t):[]}(t.name),{updateBlockBindings:l,removeAllBlockBindings:c}=(0,d.useBlockBindingsUtils)(),{isSiteEditor:a,templatePostType:u}=(0,h.useSelect)(e=>{const{getCurrentPostType:t,getCurrentPostId:s}=e(r.store),{getEditedEntityRecord:o}=e(n.store),l=t(),c=s();if("wp_template"!==l)return{isSiteEditor:!1,templatePostType:null};const i=o("postType","wp_template",c);var a;return{isSiteEditor:!0,templatePostType:(a=i?.slug||"")?a.startsWith("single-")?a.replace("single-",""):a.startsWith("archive-")?a.replace("archive-",""):"single"===a?"post":null:null}},[]),w=(0,h.useSelect)(e=>{const{getCurrentPostType:t,getCurrentPostId:s}=e(r.store),{getEditedEntityRecord:o}=e(n.store),l=t(),c=s();if(!l||!c||"wp_template"===l)return{};const i=o("postType",l,c),a={};return i?.acf&&Object.entries(i.acf).forEach(([e,t])=>{if(e.endsWith("_source")){const n=e.replace("_source","");Object.hasOwn(i.acf,n)&&(a[n]=t)}}),a},[]),{fields:b}=_(u),y=a?b:w,k=(0,i.useMemo)(()=>{return(e=y)&&0!==Object.keys(e).length?Object.entries(e).map(([e,t])=>({value:e,label:t.label,type:t.type})):[];var e},[y]),{boundFields:j,setBoundFields:v}=function(e){const[t,n]=(0,i.useState)({});return(0,i.useEffect)(()=>{const t=e?.metadata?.bindings||{},r={};Object.keys(t).forEach(e=>{t[e]?.args?.key&&(r[e]=t[e].args.key)}),n(r)},[e?.metadata?.bindings]),{boundFields:t,setBoundFields:n}}(t.attributes),C=(0,i.useCallback)((e=null)=>m(k,t.name,e),[k,t.name]),E=(0,i.useMemo)(()=>function(e,t){if(!t||t.length<=1)return!1;const n=f[e];if(!n)return!1;const r=n[t[0]]||[];return t.every(e=>{const t=n[e]||[];return t.length===r.length&&t.every(e=>r.includes(e))})}(t.name,o),[t.name,o]),S=(0,i.useCallback)((e,t)=>{if(Array.isArray(e)){const n={...j},r={};e.forEach(e=>{n[e]=t,r[e]=t?{source:g,args:{key:t}}:void 0}),v(n),l(r)}else v(n=>({...n,[e]:t})),l({[e]:t?{source:g,args:{key:t}}:void 0})},[j,v,l]),B=(0,i.useCallback)(()=>{c(),v({})},[c,v]);return(0,i.useMemo)(()=>a?o&&o.length>0:k.length>0&&o&&o.length>0,[a,k,o])?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(d.InspectorControls,{...t,children:(0,x.jsx)(p.__experimentalToolsPanel,{label:(0,s.__)("Connect to a field","secure-custom-fields"),resetAll:B,children:E?(0,x.jsx)(p.__experimentalToolsPanelItem,{hasValue:()=>!!j[o[0]],label:(0,s.__)("All attributes","secure-custom-fields"),onDeselect:()=>S(o,null),isShownByDefault:!0,children:(0,x.jsx)(p.ComboboxControl,{label:(0,s.__)("Field","secure-custom-fields"),placeholder:(0,s.__)("Select a field","secure-custom-fields"),options:C(),value:j[o[0]]||"",onChange:e=>S(o,e),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0})}):o.map(e=>(0,x.jsx)(p.__experimentalToolsPanelItem,{hasValue:()=>!!j[e],label:e,onDeselect:()=>S(e,null),isShownByDefault:!0,children:(0,x.jsx)(p.ComboboxControl,{label:e,placeholder:(0,s.__)("Select a field","secure-custom-fields"),options:C(e),value:j[e]||"",onChange:t=>S(e,t),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0})},`scf-binding-${e}`))})}),(0,x.jsx)(e,{...t})]}):(0,x.jsx)(e,{...t})},"withCustomControls");(0,a.addFilter)("editor.BlockEdit","secure-custom-fields/with-custom-controls",k)})();